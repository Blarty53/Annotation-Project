<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Annotation Project</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Annotation Project</h1>
<p>A simple, transparent way to add evidence-based context to online claims.</p>

<h2>Search by URL</h2>
<input type="text" id="searchInput" placeholder="Paste a URL here" style="width: 100%; padding: 10px; margin-bottom: 10px;">
<button onclick="searchAnnotations()" style="padding: 10px 20px;">Search</button>

<div id="searchResults"></div>

<h2>Evidence Policy</h2>
<p>Every annotation must include at least one archived primary source, a snapshot, 
a clear verdict, and a confidence rating. Claims must be quoted or paraphrased 
accurately, and all evidence must be archived for permanence.</p>

<h2>Annotations</h2>
<div id="annotations"></div>

<script>
function checkURLParameter() {
    const params = new URLSearchParams(window.location.search);
    const url = params.get('search');

    if (url) {
        document.getElementById('searchInput').value = decodeURIComponent(url);
        searchAnnotations();
    }
}
    
let annotations = [];

async function loadAnnotations() {
    const res = await fetch('annotations.json');
    annotations = await res.json();
    displayAllAnnotations();
}

function displayAllAnnotations() {
    const container = document.getElementById('annotations');
    container.innerHTML = '';

    annotations.forEach(item => {
        container.appendChild(createAnnotationCard(item));
    });
}

function createAnnotationCard(item) {
    const div = document.createElement('div');
    div.className = 'annotation';

    div.innerHTML = `
        <h3>${item.claim}</h3>
        <p><strong>Verdict:</strong> ${item.verdict}</p>
        <p><strong>Why:</strong> ${item.why}</p>
        <p><strong>Original Page:</strong> <a href="${item.original_link}" target="_blank">View Original</a></p>
        <p><strong>Archived Link:</strong> <a href="${item.archived_link}" target="_blank">View Archive</a></p>
        <p><strong>Hypothesis Annotation:</strong> <a href="${item.hypothesis_link}" target="_blank">View on Hypothes.is</a></p>
        <p><strong>Timestamp:</strong> ${item.timestamp}</p>
        <hr>
    `;

    return div;
}

function searchAnnotations() {
    const query = document.getElementById('searchInput').value.trim();
    const resultsDiv = document.getElementById('searchResults');
    resultsDiv.innerHTML = '';

    if (!query) {
        resultsDiv.innerHTML = '<p>Please enter a URL.</p>';
        return;
    }

    const match = annotations.find(a => a.original_link === query);

    if (match) {
        resultsDiv.appendChild(createAnnotationCard(match));
    } else {
        resultsDiv.innerHTML = '<p>No annotation found for this URL.</p>';
    }
}

loadAnnotations().then(checkURLParameter);

</script>


</body>
</html>
